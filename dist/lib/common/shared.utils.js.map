{"version":3,"file":"shared.utils.js","sourceRoot":"","sources":["../../../src/lib/common/shared.utils.ts"],"names":[],"mappings":"AAIA,MAAM,CAAC,MAAM,uBAAuB,GAAG,CAAC,EAAU,EAAU,EAAE;IAC5D,OAAO,YAAY,EAAE,EAAE,CAAC;AAC1B,CAAC,CAAA;AAED,MAAM,CAAC,MAAM,OAAO,GAAG,CAAI,GAAM,EAAE,EAAE;IACnC,OAAO,GAAG,KAAK,IAAI,IAAI,GAAG,KAAK,SAAS,CAAC;AAC3C,CAAC,CAAA;AAED,MAAM,CAAC,MAAM,kBAAkB,GAAG,CAAC,MAA2B,EAAE,EAAE;IAChE,IAAI,CAAC,EAAE,EAAE;QACP,OAAO,CAAC,KAAK,CAAC,0CAA0C,CAAC,CAAC;QAC1D,OAAO,IAAI,CAAC;KACb;IAED,MAAM,GAAG,GAAG,IAAI,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IACpC,MAAM,OAAO,GAAG,uBAAuB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IAClD,MAAc,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC;IAE/B,OAAO,GAAG,CAAC;AACb,CAAC,CAAA;AAED,MAAM,CAAC,MAAM,kBAAkB,GAAG,CAAC,cAAqC,EAAE,EAAE;IAC1E,MAAM,IAAI,GAAW,2BAA2B,CAAC;IAChD,MAAc,CAAC,IAAI,CAAC,GAAI,MAAc,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;IACnD,MAAc,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;QAC9B,IAAI;YACF,KAAK,MAAM,MAAM,IAAI,cAAc,EAAE;gBACnC,IAAI,CAAC,MAAM,EAAE;oBACX,OAAO,CAAC,KAAK,CAAC,yDAAyD,CAAC,CAAC;oBACzE,SAAS;iBACV;gBAED,kBAAkB,CAAC,MAAM,CAAC,CAAC;aAC5B;SACF;QAAC,OAAO,CAAC,EAAE;SACX;IACH,CAAC,CAAC,CAAC;IAEH,MAAM,CAAC,GAAG,QAAQ,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;IACrD,MAAM,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IAC3C,CAAC,CAAC,IAAI,GAAG,iBAAiB,CAAC;IAC3B,CAAC,CAAC,KAAK,GAAG,IAAI,CAAC;IAEf,MAAM,WAAW,GAAG,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;IAEtE,IAAI,WAAW,EAAE;QACf,CAAC,CAAC,GAAG,GAAG,0DAA0D,CAAC;KACpE;SAAM;QACL,CAAC,CAAC,GAAG,GAAG,qCAAqC,CAAC;KAC/C;IAED,MAAM,cAAc,GAAG,GAAG,EAAE;QAC1B,IAAI,CAAC,CAAC,EAAE,UAAU,EAAE;YAClB,OAAO,CAAC,KAAK,CAAC,oDAAoD,CAAC,CAAC;YACpE,OAAO;SACR;QAED,CAAC,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAClC,CAAC,CAAC;IAEF,IAAK,MAAc,EAAE,KAAK,KAAK,gBAAgB,EAAE;QAC/C,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,cAAc,EAAE,KAAK,CAAC,CAAC;KACtE;SAAM;QACL,cAAc,EAAE,CAAC;KAClB;IACD,OAAO,IAAI,CAAC;AACd,CAAC,CAAA","sourcesContent":["import {YandexCounterConfig} from \"../yandexCounterConfig.service\";\r\n\r\nexport declare var Ya: any;\r\n\r\nexport const UtilsGetCounterNameById = (id: string): string => {\r\n  return `yaCounter${id}`;\r\n}\r\n\r\nexport const isExist = <T>(obj: T) => {\r\n  return obj !== null && obj !== undefined;\r\n}\r\n\r\nexport const UtilsCreateCounter = (config: YandexCounterConfig) => {\r\n  if (!Ya) {\r\n    console.error(`[Yandex.Metric] not exist 3DParty script`);\r\n    return null;\r\n  }\r\n\r\n  const ptr = new Ya.Metrika2(config);\r\n  const keyName = UtilsGetCounterNameById(config.id);\r\n  (window as any)[keyName] = ptr;\r\n\r\n  return ptr;\r\n}\r\n\r\nexport const insertYandexMetric = (counterConfigs: YandexCounterConfig[]) => {\r\n  const name: string = 'yandex_metrika_callbacks2';\r\n  (window as any)[name] = (window as any)[name] || [];\r\n  (window as any)[name].push(() => {\r\n    try {\r\n      for (const config of counterConfigs) {\r\n        if (!config) {\r\n          console.error(`[insertYandexMetric] not exist config in counterConfigs`);\r\n          continue;\r\n        }\r\n\r\n        UtilsCreateCounter(config);\r\n      }\r\n    } catch (e) {\r\n    }\r\n  });\r\n\r\n  const n = document.getElementsByTagName('script')[0];\r\n  const s = document.createElement('script');\r\n  s.type = 'text/javascript';\r\n  s.async = true;\r\n\r\n  const alternative = counterConfigs.find(config => config.alternative);\r\n\r\n  if (alternative) {\r\n    s.src = 'https://cdn.jsdelivr.net/npm/yandex-metrica-watch/tag.js';\r\n  } else {\r\n    s.src = 'https://mc.yandex.ru/metrika/tag.js';\r\n  }\r\n\r\n  const insetScriptTag = () => {\r\n    if (!n?.parentNode) {\r\n      console.error(`[YandexMetric.insetScriptTag] not exist parentNode`);\r\n      return;\r\n    }\r\n\r\n    n.parentNode.insertBefore(s, n);\r\n  };\r\n\r\n  if ((window as any)?.opera === '[object Opera]') {\r\n    document.addEventListener('DOMContentLoaded', insetScriptTag, false);\r\n  } else {\r\n    insetScriptTag();\r\n  }\r\n  return name;\r\n}\r\n"]}